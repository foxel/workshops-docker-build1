# Workshop #2 "Isolating application"

## step 0: Environment variables as a config

### Идея
При запуске docker образа пользователь может задать переменные окружения для процессов внутри контейнера:
```
$ docker run --rm -e ADMIN_PASSWORD='T3VjaFRoaXNJc1ByaXZhdGU=' hacher/secure_service
```

Данную возможность можно использовать для установки каких-либо настроек докеризированного приложения.
Данный подход применяется очень часто, даже в официальных образах популярных приложений. 
Примеры: [MySQL](https://hub.docker.com/_/mysql/), [Postgres](https://hub.docker.com/_/postgres/), [Redmine](https://hub.docker.com/_/redmine/). 

### Как сделать?

Чтобы добавить возможность конфигурирования приложения через переменные окружения не обязательно переделывать приложение.
Достаточно добавить стартовый скрипт, который подготовит/изменит конфигурационные файлы прилодения согласно переданных в 
переменных окружения параметрам. Для этого можно использовать различные инструменты. 
Самый простой (или скорее самый легковесный) вариант - использование [sed](https://www.gnu.org/software/sed/manual/sed.html).

Также можно использовать более продвинутые инструменты:
- шаблонизаторы, такие как mustache, go template, etc.
- специализированные утилиты типа `crudini`

Примеры можно посмотреть в папке `step0`

### Задание

* В `step0` есть примеры образов с изменением настроек через переменные окружения.
Для каждого из вариантов добавить возможность изменить пароль пользователя в секции AUTH.
* Какой из вариантов более надежен?

## step 1: ARG for custom builds

[ARG](https://docs.docker.com/engine/reference/builder/#arg) в Dockerfile аналогичен ENV, но используется не при запуске контейнера а при его сборке.
Соответственно его значение задается также при сборке. Делается это при помощи аргумента `--build-arg <varname>=<value>`.
Область применения данной функции может включать множество вариантов. 
Очевидное использование - задание версии приложения (или тега в репозитории) для сборки. 

### Пример

Пример можно посмотреть в папке `step1`.

### Задание

Собрать образ из примера для какой-либо версии консула. См [доступные версии consul](https://releases.hashicorp.com/consul).


## step #2: `docker build` useful arguments
